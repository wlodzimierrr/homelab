apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-rbac-cm
  namespace: {{ argocd_namespace }}
data:
{% if argocd_rbac_policy_default is defined and argocd_rbac_policy_default %}
  policy.default: {{ argocd_rbac_policy_default | quote }}
{% endif %}
  policy.csv: |
{% for line in (argocd_rbac_policy_csv_lines | default([])) %}
    {{ line }}
{% endfor %}
{% if argocd_rbac_scopes is defined and argocd_rbac_scopes %}
  scopes: {{ argocd_rbac_scopes | quote }}
{% endif %}
{% for key, value in (argocd_rbac_extra_data | default({}) | dictsort) %}
{% if '\n' in (value | string) %}
  {{ key }}: |
{{ value | string | indent(4, true) }}
{% else %}
  {{ key }}: {{ value | string | quote }}
{% endif %}
{% endfor %}
